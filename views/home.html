{{ block "home" . }}
<!DOCTYPE html>
<html lang="en">
        <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1">
                <title>forumv2</title>
                <script src="https://unpkg.com/htmx.org@2.0.4" 
                        integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+" 
                        crossorigin="anonymous">
                </script>
                <link href="/css/home.css" rel="stylesheet">
        </head>
        <body>
                {{ template "navbar" . }}

                <div class="home-container">
                        {{ template "home-table" . }}
                </div>

                <script>
                        document.addEventListener("DOMContentLoaded", (event) => {
                                document.body.addEventListener("htmx:beforeSwap", function(evt) {
                                        if (evt.detail.xhr.status === 422 || evt.detail.xhr.status === 500) {
                                                evt.detail.shouldSwap = true;
                                                evt.detail.isError = false;
                                        }
                                });
                        });
                </script>
        </body>
</html>
{{ end }}

{{ block "home-table" . }}
        <table>
                {{ template "home-table-header" . }}

                <tbody id="topic-display">
                        {{ template "home-table-content" . }}
                </tbody>
        </table>
{{ end }}

{{ block "home-form" . }}
        <form 
                hx-post="/topic" 
                class="form"
                hx-swap="outerHTML"
        >
                {{ if .User.UUID }}
                        <input type="text" name="name" placeholder="name" class="name-input" maxlength="95"/>
                        <textarea type="text" name="message" placeholder="description" class="message-input"></textarea>
                        <button type="submit" class="button-submit">Post topic</button>
                {{ else }}
                        <p>Login to post a topic</p>
                {{ end }}

                {{ template "status" .Status }}
        </form>
{{ end }}

{{ block "home-table-header" . }}
        <tr>
                <th class="name">Name</th>
                <th>Author</th>
                <th>Messages</th>
                <th>LastMessage</th>
        </tr>
{{ end }}

{{ block "home-table-content" . }}
        {{ $userUUID := .User.UUID }}

        {{ range .Topics }}
                <tr id="topic{{ .UUID }}" class="table-content">
                        <td><a class="link" href="/topic/{{ .UUID }}">{{ .Name }}</a></td>
                        <td><a class="link" href="/user/{{ .CreatedByUsername }}">{{ .CreatedByUsername }}</a></td>
                        <td>{{ .NmbMessages }}</td>
                        <td>{{ .FormattedLastMessage }}</td>
                </tr>
        {{ end }}
{{ end }}

{{ block "oob-topic" . }}
        <tbody id="topic-display" hx-swap-oob="afterbegin">
                {{ template "home-table-content" . }}
        </tbody>
{{ end }}
